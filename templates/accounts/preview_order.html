{% extends 'base.html' %}
{% load static %}
{% load form_filters %}
{% block title %}سفارش نهایی{% endblock %}

{% block content %}
<div class="breadcrumb-area breadcrumb-bg-1 pt-50 pb-70 mb-130">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<h1 class="breadcrumb-title">سفارش نهایی</h1>

					<!--=======  breadcrumb list  =======-->

					<ul class="breadcrumb-list">
						<li class="breadcrumb-list__item"><a href="{%url 'main:home'%}">صفحه اصلی</a></li>
						<li class="breadcrumb-list__item breadcrumb-list__item--active">سفارش نهایی</li>
					</ul>

					<!--=======  End of breadcrumb list  =======-->

				</div>
			</div>
		</div>
	</div>

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8 col-12">
           
            <form method="POST" action="{% url 'accounts:payment_request' %}">
                {% csrf_token %}

                <div class="address-box">
                    
                    {% if items %}
                    <div class="cart-summary-box p-3 shadow-sm mb-4 rounded">

                        <h5 class="mb-3 text-center">خلاصه سبد خرید</h5>

                        <div style="display:flex; flex-wrap:wrap; gap:15px; justify-content:center;">
                            {% for item in items %}
                            <div style="width:150px; border:1px solid #ddd; padding:10px; border-radius:8px; text-align:center;">
                                <img src="{{ item.product.image.url }}" 
                                    style="width:100%; height:100px; object-fit:cover; border-radius:6px;">
                                <p class="mt-2"><strong>{{ item.product.title }}</strong></p>
                                <p>تعداد: {{ item.quantity }}</p>
                                <p><strong>{{ item.total_price }} تومان</strong></p>
                            </div>
                            {% endfor %}
                        </div>

                        <hr>
                        <p class="text-center"><strong>جمع سبدخرید:</strong> {{ final_price }} تومان</p>
                    </div>
                    {% endif %}

                    <p><strong>آدرس:</strong> {{ address }}</p>
                    <p><strong>هزینه ارسال:</strong> {{ shipping_cost }}</p>
                    <p><strong>جمع کل:</strong> {{ total_to_pay }}</p>
                </div>

                <input type="hidden" name="address" value="{{ address.id }}">
                <input type="hidden" name="final_price" value="{{ final_price }}">
                <input type="hidden" name="shipping_cost" value="{{ shipping_cost }}">
                <input type="hidden" name="total_to_pay" value="{{ total_to_pay }}">

                <div class="mt-3">
                    <label><strong>توضیحات اضافه سفارش:</strong></label>
                    <textarea name="order_note" placeholder="اگر توضیحی دارید بنویسید..." 
                            class="form-control"
                            style="height:120px; border-radius:10px; margin-top:10px;">{{ order_note }}</textarea>
                </div>

                <div class="text-center mt-3">
                    <button type="submit" class="btn btn-dark px-4">پرداخت</button>
                </div>
            </form>

        </div>
    </div>
</div>
{% endblock %}
